{"version":3,"file":"touchkit.es.js","sources":["../node_modules/mtouch/src/utils.js","../node_modules/mtouch/src/singleBtn.js","../node_modules/mtouch/src/handlerBus.js","../node_modules/mtouch/src/index.js","../node_modules/mcanvas/src/utils.js","../node_modules/mcanvas/src/index.js","../src/removeBtn.js","../src/utils.js","../src/zIndex.js","../src/index.js"],"sourcesContent":["let sheet;\nexport default {\n    getLength(v1) {\n        if (typeof v1 !== 'object') {\n            console.error('getLength error!');\n            return;\n        }\n        return Math.sqrt(v1.x * v1.x + v1.y * v1.y);\n    },\n    getAngle(v1, v2) {\n        if (typeof v1 !== 'object' || typeof v2 !== 'object') {\n            console.error('getAngle error!');\n            return;\n        }\n        // 判断方向，顺时针为 1 ,逆时针为 -1；\n        let direction = v1.x * v2.y - v2.x * v1.y > 0 ? 1: -1,\n            // 两个向量的模；\n            len1 = this.getLength(v1),\n            len2 = this.getLength(v2),\n            mr = len1 * len2,\n            dot,r;\n        if (mr === 0)return 0;\n        // 通过数量积公式可以推导出：\n        // cos = (x1 * x2 + y1 * y2)/(|a| * |b|);\n        dot = v1.x * v2.x + v1.y * v2.y;\n        r = dot / mr;\n        if (r > 1)r = 1;\n        if (r < -1)r = -1;\n        // 解值并结合方向转化为角度值；\n        return Math.acos(r) * direction * 180 / Math.PI;\n    },\n    getBasePoint(el) {\n        if (!el) return {x:0,y:0};\n        let offset = this.getOffset(el);\n        let x = offset.left + el.getBoundingClientRect().width / 2,\n            y = offset.top + el.getBoundingClientRect().width / 2;\n        return {x: Math.round(x), y: Math.round(y)};\n    },\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if(typeof obj2[k] == 'object' && !(obj2[k] instanceof Node)){\n                    if(typeof obj1[k] !== 'object'){\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k],obj2[k]);\n                }else{\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    getVector(p1, p2) {\n        if (typeof p1 !== 'object' || typeof p2 !== 'object' ) {\n            console.error('getvector error!');\n            return;\n        }\n        let x = Math.round(p1.x - p2.x),\n            y = Math.round(p1.y - p2.y);\n        return { x, y };\n    },\n    getPoint(ev, index) {\n        if (!ev || !ev.touches[index]) {\n            console.error('getPoint error!');\n            return;\n        }\n        return {\n            x: Math.round(ev.touches[index].pageX),\n            y: Math.round(ev.touches[index].pageY),\n        };\n    },\n    getOffset(el){\n        el = typeof el == 'string'? document.querySelector(el): el;\n        let rect = el.getBoundingClientRect();\n        let offset = {\n            left:rect.left + document.body.scrollLeft,\n            top:rect.top + document.body.scrollTop,\n            width:el.offsetWidth,\n            height:el.offsetHeight,\n        };\n        return offset;\n    },\n    matrixTo(matrix){\n        let arr = (matrix.replace('matrix(','').replace(')','')).split(',');\n        let cos = arr[0],\n            sin = arr[1],\n            tan = sin / cos,\n            rotate = Math.atan( tan ) * 180 / Math.PI,\n            scale = cos / ( Math.cos( Math.PI / 180 * rotate )),\n            trans;\n        trans = {\n            x:parseInt(arr[4]),\n            y:parseInt(arr[5]),\n            scale,\n            rotate,\n        };\n        return trans;\n    },\n    getUseName(evName){\n        let useName = evName.replace('start','');\n        let end = useName.indexOf('rotate') !== -1 ? 'nd' : 'end';\n        useName = useName.replace(end,'');\n        return useName;\n    },\n    domify(DOMString) {\n        let htmlDoc = document.implementation.createHTMLDocument();\n        htmlDoc.body.innerHTML = DOMString;\n        return htmlDoc.body.children;\n    },\n    getEl(el){\n        if(!el){\n            console.error('el error,there must be a el!');\n            return;\n        }\n        let _el;\n        if(typeof el == 'string'){\n            _el = document.querySelector(el);\n        }else if(el instanceof Node){\n            _el = el;\n        }else{\n            console.error('el error,there must be a el!');\n            return;\n        }\n        return _el;\n    },\n    data(el,key){\n        el = this.getEl(el);\n        return el.getAttribute(`data-${key}`);\n    },\n    include(str1,str2){\n        if(str1.indexOf){\n            return str1.indexOf(str2) !== -1;\n        }else{\n            return false;\n        }\n    },\n    getPos(el) {\n        if(!el)return;\n        el = this.getEl(el);\n        let defaulTrans;\n        let style = window.getComputedStyle(el,null);\n        let cssTrans = style.transform || style.webkitTransform;\n\n        if(window.getComputedStyle && cssTrans !== 'none'){\n            defaulTrans = this.matrixTo(cssTrans);\n        }else{\n            defaulTrans = {\n                x: 0,\n                y: 0,\n                scale: 1,\n                rotate: 0,\n            };\n        }\n        return JSON.parse(el.getAttribute('data-mtouch-status')) || defaulTrans;\n    },\n    addCssRule(selector, rules){\n        if(!sheet){\n            sheet = createStyleSheet();\n        }\n        sheet.insertRule(`${selector}{${rules}}`,sheet.rules.length);\n    },\n};\n\nfunction createStyleSheet() {\n    let style = document.createElement('style');\n    style.type = 'text/css';\n    document.head.appendChild(style);\n    return style.sheet;\n}\n","let base64 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyppVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTMyIDc5LjE1OTI4NCwgMjAxNi8wNC8xOS0xMzoxMzo0MCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUuNSAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3QUY3RkU4M0E5OEIxMUU2QjU0QTkxRjBDMUE2RDg3NCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3QUY3RkU4NEE5OEIxMUU2QjU0QTkxRjBDMUE2RDg3NCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjdBRjdGRTgxQTk4QjExRTZCNTRBOTFGMEMxQTZEODc0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjdBRjdGRTgyQTk4QjExRTZCNTRBOTFGMEMxQTZEODc0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ckj5SQAAA5tJREFUeNrsm0tIVUEYx7+TSuHVIk2sjfTQTaQLo425KXq3yF7gwrASwozKVmG0DNoElUQgYRQECT0JKum1SjeRkFaLnuAmpCxIrxkit//X/W7dpOu9Z+acmSOeD34oepn5fs6Z15nRicViNJ1iBk2zCIVD4VB4akd2ql/UnvGk/CJQBSpBKVgE5oE8+f0w+AI+gnegB3TJz7Sio9mlsEYUgO1COXAm+WyesBCskp/xPNkHbghfjbSwQhSDw/xwgFka5fAfqEJoAVdBKxgISh/OAU3gKditKTsxuKw9UnaT1GVVmPvkXXAcRHwcayJSx31QZkt4HegEywwOskvBPanbqHA9aAf5FmaWiNRdb0q4DpwEWRan0yzJoc5v4Q1SUVCCc1nvlzAPUGctt+z/WrpVcvNUmKeDNkt9Nl3kS27ZXgrvNzwauw3ObZ9XK635oDmDteuCdJ+5/YyGOrp+r5/9iCOyFB3QbeFGL1ZPPssmpqtG3Ue6QGXotyCbiF1gro7wDpCrKTtsSJYk1506wtu0n7OZ5DhmB7CtqsJFsp/VirUVFNm7mmYblK6QlwyuhavSbN4n7bMPeylqSdqR3F1PS5U6A5STJJv89eIT+m7g1f9ycMdtC5epyibe07CcpZYuVXmkS3SnHovSJSrChW5qSDX1WJIuVBHO9ar2hPSjPmPSuX684nEt3f7YqLRr4ZEpLD2iIjwYlJauXel6Hz6oItwfhMebZWtW/DmayTT6VYTf2u7TirIc71RWWj2mBjL+fk35vyuy6E+KKcpyPFcR7pacHFvSGkV2qzzSnyl+imdlytKIXprkuDXdPHzT5DwdHSUv9hW3dF4AXAc/TAjzALVFvc8mgnO9piPMh9EdJmRr9GVJcv2mI8xxDoxOAVnu/63pPpTJe+lPFD9iOeqHMHZZvK0c8qCo05TBLYFMNw/nwWsKbrwCF3Q3D8kxRvErB9EAynJOByRHz4Q53oBDYDxAspzLQcmNvBbm4DsWLQES5lw6vdoPp4orUtG45ZZtkVzIb2GOy6CByNgRysQ+2yA5kClhjgcUvwLx0qAszxSbpG4yLczxAWwGJ3wewaNSx0bdfboXL/HGZJ6uBpc8XpWNSpnVUseYboFe3rXkVc4xcIriR5Z8ipfucmmqjVOv7NQCfbk0ecPRJhRL6/CJ3hKwGMyh+A3aHPp7fZi7xnvwguLXhwf86htO+F8toXAoHAqHwgGOXwIMAGwpGJYKZlZqAAAAAElFTkSuQmCC`;\n\nexport default base64;\n","export default class HandlerBus{\n    constructor(el) {\n        this.handlers = [];\n        this.el = el;\n    }\n    add(handler){\n        this.handlers.push(handler);\n        return this;\n    }\n    del(handler){\n        if(!handler){\n            this.handlers = [];\n        }else{\n            this.handlers.forEach((value,index)=>{\n                if(value === handler){\n                    this.handlers.splice(index,1);\n                }\n            });\n        }\n        return this;\n    }\n    fire(){\n        if(!this.handlers || !this.handlers.length === 0)return;\n        this.handlers.forEach(handler=>{\n            if(typeof handler === 'function') handler.apply(this.el, arguments);\n        });\n        return this;\n    }\n}\n","import _ from './utils';\nimport singleBtn from './singleBtn';\nimport HandlerBus from './handlerBus';\n\nconst EVENT = ['touchstart','touchmove','touchend','drag','dragstart','dragend','pinch','pinchstart','pinchend','rotate','rotatestart','rotatend','singlePinchstart','singlePinch','singlePinchend','singleRotate','singleRotatestart','singleRotatend'];\n\nconst ORIGINEVENT = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\n\nexport default function MTouch(el = '') {\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MTouch))return new MTouch(el);\n    // 开关；\n    // 初始化时关闭，在调用 on 函数时对应开启；\n    this.use = {\n        drag: false,\n        pinch: false,\n        rotate: false,\n        singlePinch: false,\n        singleRotate: false,\n    };\n    // 获取容器元素；\n    this.operator = this.el = _.getEl(el);\n    // 状态记录；\n    this.draging = this.pinching = this.rotating = this.singlePinching = this.singleRotating = false;\n    // 全局参数记录；\n    this.fingers = 0;\n    this.startScale = 1;\n    this.startPoint = {};\n    this.secondPoint = {};\n    this.pinchStartLength = null;\n    this.singlePinchStartLength = null;\n    this.vector1 = {};\n    this.singleBasePoint = {};\n\n    // 插入css;\n    this._css();\n    // 初始化注册事件队列；\n    this._driveBus();\n    // 监听原生 touch 事件；\n    this._bind();\n}\n\nMTouch.prototype._driveBus = function() {\n    EVENT.forEach(evName => {\n        this[evName] = new HandlerBus(this.el);\n    });\n};\n\nMTouch.prototype._bind = function() {\n    ORIGINEVENT.forEach(evName => {\n        let fn = evName == 'touchcancel'? 'end': evName.replace('touch', '');\n        // 需要存下 bind(this) 后的函数指向，用于 destroy;\n        this[`_${fn}_bind`] = this[`_${fn}`].bind(this);\n        this.el.addEventListener(evName, this[`_${fn}_bind`], false);\n    });\n};\nMTouch.prototype.destroy = function() {\n    ORIGINEVENT.forEach(evName => {\n        let fn = evName == 'touchcancel' ? 'end' : evName.replace('touch', '');\n        this.el.removeEventListener(evName, this[`_${fn}_bind`], false);\n    });\n};\nMTouch.prototype._start = function(e) {\n    if (!e.touches || e.type !== 'touchstart')return;\n    // 记录手指数量；\n    this.fingers = e.touches.length;\n    // 记录第一触控点；\n    this.startPoint = _.getPoint(e, 0);\n    // 计算单指操作时的基础点；\n    this.singleBasePoint = _.getBasePoint(this.operator);\n    // 双指操作时\n    if (this.fingers > 1) {\n        // 第二触控点；\n        this.secondPoint = _.getPoint(e, 1);\n        // 计算双指向量；\n        this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n        // 计算向量模；\n        this.pinchStartLength = _.getLength(this.vector1);\n    } else if (this.use.singlePinch) {\n        // 单指且监听 singlePinch 时，计算向量模；\n        let pinchV1 = _.getVector(this.startPoint, this.singleBasePoint);\n        this.singlePinchStartLength = _.getLength(pinchV1);\n    }\n    // 触发 touchstart 事件；\n    this.touchstart.fire({origin: e, eventType: 'touchstart'});\n};\nMTouch.prototype._move = function(ev) {\n    if (!ev.touches || ev.type !== 'touchmove')return;\n    // 判断触控点是否为 singlebutton 区域；\n    let isSingleButton = _.data(ev.target,'singleButton'),\n        curFingers = ev.touches.length,\n        curPoint = _.getPoint(ev, 0),\n        singlePinchLength,\n        pinchLength,\n        rotateV1,\n        rotateV2,\n        pinchV2;\n    // 当从原先的两指到一指的时候，可能会出现基础手指的变化，导致跳动；\n    // 因此需屏蔽掉一次错误的touchmove事件，待重新设置基础指后，再继续进行；\n    if (curFingers < this.fingers) {\n        this.startPoint = curPoint;\n        this.fingers = curFingers;\n        return;\n    }\n    // 两指先后触摸时，只会触发第一指一次 touchstart，第二指不会再次触发 touchstart；\n    // 因此会出现没有记录第二指状态，需要在touchmove中重新获取参数；\n    if (curFingers > 1 && (!this.secondPoint || !this.vector1 || !this.pinchStartLength)) {\n        this.secondPoint = _.getPoint(ev, 1);\n        this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n        this.pinchStartLength = _.getLength(this.vector1);\n    }\n    // 双指时，需触发 pinch 和 rotate 事件；\n    if (curFingers > 1) {\n        let curSecPoint = _.getPoint(ev, 1),\n            vector2 = _.getVector(curSecPoint, curPoint);\n        // 触发 pinch 事件；\n        if (this.use.pinch) {\n            pinchLength = _.getLength(vector2);\n            this._eventFire('pinch', {\n                delta: {\n                    scale: pinchLength / this.pinchStartLength,\n                },\n                origin: ev,\n            });\n            this.pinchStartLength = pinchLength;\n        }\n        // 触发 rotate 事件；\n        if (this.use.rotate) {\n            this._eventFire('rotate', {\n                delta: {\n                    rotate: _.getAngle(this.vector1, vector2),\n                },\n                origin: ev,\n            });\n            this.vector1 = vector2;\n        }\n    } else {\n        // 触发 singlePinch 事件;\n        if (this.use.singlePinch && isSingleButton) {\n            pinchV2 = _.getVector(curPoint, this.singleBasePoint);\n            singlePinchLength = _.getLength(pinchV2);\n            this._eventFire('singlePinch', {\n                delta: {\n                    scale: singlePinchLength / this.singlePinchStartLength,\n                    deltaX:curPoint.x - this.startPoint.x,\n                    deltaY:curPoint.y - this.startPoint.y,\n                },\n                origin: ev,\n            });\n            this.singlePinchStartLength = singlePinchLength;\n        }\n        // 触发 singleRotate 事件;\n        if (this.use.singleRotate && isSingleButton) {\n            rotateV1 = _.getVector(this.startPoint, this.singleBasePoint);\n            rotateV2 = _.getVector(curPoint, this.singleBasePoint);\n            this._eventFire('singleRotate', {\n                delta: {\n                    rotate: _.getAngle(rotateV1, rotateV2),\n                },\n                origin: ev,\n            });\n        }\n    }\n    // 触发 drag 事件；\n    if (this.use.drag) {\n        if (!isSingleButton) {\n            this._eventFire('drag', {\n                delta: {\n                    deltaX: curPoint.x - this.startPoint.x,\n                    deltaY: curPoint.y - this.startPoint.y,\n                },\n                origin: ev,\n            });\n        }\n    }\n    this.startPoint = curPoint;\n    // 触发 touchmove 事件；\n    this.touchmove.fire({eventType: 'touchmove', origin: ev});\n    ev.preventDefault();\n};\nMTouch.prototype._end = function(ev) {\n    if (!ev.touches && ev.type !== 'touchend' && ev.type !== 'touchcancel')return;\n    // 触发 end 事件；\n    ['pinch', 'drag', 'rotate', 'singleRotate', 'singlePinch'].forEach(evName => {\n        this._eventEnd(evName, {origin: ev});\n    });\n    this.touchend.fire({eventType: 'touchend', origin: ev});\n};\nMTouch.prototype._eventFire = function(evName, ev) {\n    let ing = `${evName}ing`,\n        start = `${evName}start`;\n    if (!this[ing]) {\n        ev.eventType = start;\n        this[start].fire(ev);\n        this[ing] = true;\n    } else {\n        ev.eventType = evName;\n        this[evName].fire(ev);\n    }\n};\nMTouch.prototype._eventEnd = function(evName, ev) {\n    let ing = `${evName}ing`,\n        end;\n    if (evName == 'rotate' || evName == 'singleRotate') {\n        end = `${evName}nd`;\n    } else {\n        end = `${evName}end`;\n    }\n    if (this[ing]) {\n        ev.eventType = end;\n        this[end].fire(ev);\n        this[ing] = false;\n    }\n};\n// 添加 button 区域；\n// 背景样式由业务方定制；\nMTouch.prototype._addButton = function(el){\n    let button = _.domify(`<div class=\"mtouch-singleButton\" data-singleButton='true'></div>`)[0];\n    el.appendChild(button);\n    el.setAttribute('data-mtouch-addButton',true);\n};\n// 切换 operator;\nMTouch.prototype.switch = function(el,addButton = true) {\n    let _el;\n    if(!el){\n        this.operator = this.el;\n        return;\n    }\n    this.operator = _el = _.getEl(el);\n    if(!_.data(_el,'mtouch-addButton') && (this.use.singleRotate || this.use.singlePinch) && addButton){\n        this._addButton(_el);\n    }\n};\nMTouch.prototype.on = function(evName, handler = ()=>{}, operator) {\n    if(_.include(evName,' ')){\n        evName.split(' ').forEach(v=>{\n            this._on(v,handler,operator);\n        });\n    }else{\n        this._on(evName,handler,operator);\n    }\n    return this;\n};\nMTouch.prototype._on = function(evName,handler,operator){\n    this.use[_.getUseName(evName)] = true;\n    this[evName].add(handler);\n    this.switch(operator);\n};\nMTouch.prototype.off = function(evName, handler) {\n    this[evName].del(handler);\n};\n\nMTouch.prototype._css = function(){\n    _.addCssRule('.mtouch-singleButton',`z-index:9999;position:absolute;right:-15px;bottom: -15px;width:30px;height: 30px;background-size: 100% 100%;background-image:url(${singleBtn});`);\n};\n","export default {\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if (typeof obj2[k] == 'object') {\n                    if (typeof obj1[k] !== 'object' || obj1[k] === null) {\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k], obj2[k]);\n                } else {\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    loadImage(image, loaded, error) {\n        let img = new Image();\n        if(image.indexOf('http') == 0){\n            img.crossOrigin = '*';\n        }\n        img.onload = () => {\n            loaded(img);\n        };\n        img.onerror = () => {\n            error('img load error');\n        };\n        img.src = image;\n    },\n    isArr(arr) {\n        return Object.prototype.toString.call(arr) === '[object Array]';\n    },\n    getImage(image,cbk){\n        if(typeof image == 'string'){\n                this.loadImage(image, img => {\n                    cbk(img);\n                },err=>{\n                    console.log(err);\n                });\n        }else if(typeof image == 'object'){\n            cbk(image);\n        }else{\n            console.log('add image error');\n            return;\n        }\n    },\n    forin(obj,cbk){\n        for(let k in obj){\n            if(obj.hasOwnProperty(k)){\n                cbk(k,obj[k]);\n            }\n        }\n    },\n};\n","import _ from './utils';\n\nexport default function MCanvas(cwidth,cheight,background){\n\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MCanvas))\n        return new MCanvas(cwidth,cheight,background);\n\n    // 配置canvas初始大小；\n    // cwidth：画布宽度，Number,选填，默认为 500;\n    // cheight: 画布高度，Number，选填，默认与宽度一致；\n    this.ops = {\n        width: cwidth || 500,\n        height:cheight || cwidth,\n        background,\n    };\n    // 全局画布；\n    this.canvas = null;\n    this.ctx = null;\n\n    // 绘制函数队列；\n    this.queue = [];\n    // 最后执行的函数；\n    this.end = null;\n\n    // 文字绘制数据；\n    this.textData = {};\n\n    // 背景图数据;\n    this.bgConfig = null;\n\n    // 初始化创建画布；\n    this._init();\n}\n\nMCanvas.prototype._init = function(){\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = this.ops.width;\n    this.canvas.height = this.ops.height;\n    this.ctx = this.canvas.getContext('2d');\n    if(this.ops.background){\n        this.ctx.fillStyle = this.ops.background;\n        this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);\n    }\n};\n\n// --------------------------------------------------------\n// 绘制背景部分；\n// --------------------------------------------------------\n\nMCanvas.prototype.background = function(bg){\n    if(!bg){\n        if(this.bgConfig){\n            bg = this.bgConfig;\n        }else{\n            console.error('mcanvas error : the init background must has the bg option params.');\n            return;\n        }\n    }else{\n        this.bgConfig = bg;\n    }\n    this.queue.push(() => {\n        if(bg.color){\n            this.ctx.fillStyle = bg.color;\n            this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);\n        }\n        if(bg.image){\n            _.getImage(bg.image, img =>{\n                this._background(img,bg);\n            });\n        }else{\n            console.error('mcanvas error : background image error!');\n        }\n    });\n    return this;\n};\n\nMCanvas.prototype._background = function(img,bg){\n\n    let {iw,ih} = this._getSize(img);\n    // 图片与canvas的长宽比；\n    let iRatio = iw / ih;\n    let cRatio = this.canvas.width / this.canvas.height;\n    // 背景绘制参数；\n    let sx,sy,swidth,sheight,dx,dy,dwidth,dheight;\n    switch (bg.type) {\n        // 裁剪模式，固定canvas大小，原图铺满，超出的部分裁剪；\n        case 'crop':\n            sx = bg.left || 0;\n            sy = bg.top || 0;\n            if(iRatio > cRatio){\n                swidth = ih * cRatio;\n                sheight = ih;\n            }else{\n                swidth = iw;\n                sheight = swidth / cRatio;\n            }\n            dy = dx = 0;\n            dheight = this.canvas.height;\n            dwidth = this.canvas.width;\n            break;\n        // 包含模式，固定canvas大小，包含背景图；\n        case 'contain':\n            sy = sx = 0;\n            swidth = iw;\n            sheight = ih;\n            if(iRatio > cRatio){\n                dwidth = this.canvas.width;\n                dheight = dwidth / iRatio;\n                dx = bg.left || 0;\n                dy = (bg.top || bg.top == 0) ? bg.top : (this.canvas.height - dheight)/2;\n            }else{\n                dheight = this.canvas.height;\n                dwidth = dheight * iRatio;\n                dy = bg.top || 0;\n                dx = (bg.left || bg.left == 0) ? bg.left : (this.canvas.width - dwidth)/2;\n            }\n            break;\n        // 原图模式：canvas与原图大小一致，忽略初始化 传入的宽高参数；\n        // 同时，background 传入的 left/top 均被忽略；\n        case 'origin':\n            this.canvas.width = iw;\n            this.canvas.height = ih;\n            sx = sy = 0;\n            swidth = iw;\n            sheight = ih;\n            dx = dy = 0;\n            dwidth = this.canvas.width;\n            dheight = this.canvas.height;\n            break;\n        default:\n            console.error('mcanvas error:background type error!');\n    }\n    this.ctx.drawImage(img,sx,sy,swidth,sheight,dx,dy,dwidth,dheight);\n    this._next();\n};\n// --------------------------------------------------------\n// 绘制图层部分；\n// --------------------------------------------------------\n\n// 绘制水印；基于 add 函数封装；\nMCanvas.prototype.watermark = function(image = '',ops){\n    if(!image){\n        console.error('mcanvas error : there is not image of watermark.');\n        return;\n    }\n    // 参数默认值；\n    let { width = '40%' , pos = 'rightbottom' , margin = 20} = ops;\n    let position = {\n        x:0,\n        y:0,\n        scale:1,\n        rotate:0,\n    };\n    switch (pos) {\n        case 'leftTop':\n            position.x = `left:${margin}`;\n            position.y = `top:${margin}`;\n            break;\n        case 'leftBottom':\n            position.x = `left:${margin}`;\n            position.y = `bottom:${margin}`;\n            break;\n        case 'rightTop':\n            position.x = `right:${margin}`;\n            position.y = `top:${margin}`;\n            break;\n        case 'rightBottom':\n            position.x = `right:${margin}`;\n            position.y = `bottom:${margin}`;\n            break;\n        default:\n    }\n    this.add(image,{\n        width,\n        pos:position,\n    });\n    return this;\n};\n\n// 通用绘制图层函数；\n// 使用方式：\n// 多张图: add([{image:'',options:{}},{image:'',options:{}}]);\n// 单张图: add(image,options);\nMCanvas.prototype.add = function(image = '',options){\n    // 默认参数；\n    let def = {\n        width:'100%',\n        crop:{\n            x:0,\n            y:0,\n            width:'100%',\n            height:'100%',\n        },\n        pos:{\n            x:0,\n            y:0,\n            scale:1,\n            rotate:0,\n        },\n    };\n\n    if(!_.isArr(image))image = [{image,options}];\n\n    image.forEach( v =>{\n        // 将封装好的 add函数 推入队列中待执行；\n        // 参数经过 _handleOps 加工；\n        this.queue.push(() => {\n            _.getImage(v.image, img => {\n                this._add(img,this._handleOps(_.extend(def,v.options),img));\n            });\n        });\n    });\n\n    return this;\n};\n\nMCanvas.prototype._add = function(img,ops){\n    let {iw,ih} = this._getSize(img);\n    let ratio = iw / ih;\n    // 画布canvas参数；\n    let cdx,cdy,cdw,cdh;\n    // 素材canvas参数；\n    let { x:lsx, y:lsy, width:lsw, height:lsh} = ops.crop;\n    let ldx,ldy,ldw,ldh;\n    // 素材canvas的绘制;\n    let lcvs = document.createElement('canvas');\n    let lctx = lcvs.getContext('2d');\n    // 图片宽高比 * 1.4 是一个最安全的宽度，旋转任意角度都不会被裁剪；\n    // 没有旋转却长宽比很高大的图，会导致放大倍数太大，因此甚至了最高倍数为5；\n    // _ratio 为 较大边 / 较小编 的比例；\n    let _ratio = iw > ih ? iw / ih : ih / iw;\n    let lctxScale = _ratio * 1.4 > 5 ? 5 : _ratio * 1.4;\n    let spaceX,spaceY;\n\n    lcvs.width =  iw * lctxScale;\n    lcvs.height = ih * lctxScale;\n\n    // 从素材canvas的中心点开始绘制；\n    ldx = -iw / 2;\n    ldy = -ih / 2;\n    ldw = iw;\n    ldh = ih;\n\n    lctx.translate(lcvs.width/2,lcvs.height/2);\n    lctx.rotate(ops.pos.rotate);\n    lctx.drawImage(img,lsx,lsy,lsw,lsh,ldx,ldy,ldw,ldh);\n    //\n    // lcvs.style = 'width:300px';\n    // document.querySelector('body').appendChild(lcvs);\n\n    // 获取素材最终的宽高;\n    cdw = ops.width * lctxScale;\n    cdh = cdw / ratio;\n\n    spaceX = (lctxScale - 1) * ops.width / 2;\n    spaceY = spaceX / ratio;\n\n    // 获取素材的位置；\n    //    配置的位置 - 缩放的影响 - 绘制成正方形的影响；\n    cdx = ops.pos.x + cdw * ( 1 - ops.pos.scale )/2 - spaceX;\n    cdy = ops.pos.y + cdh * ( 1 - ops.pos.scale )/2 - spaceY;\n\n    cdw *= ops.pos.scale;\n    cdh *= ops.pos.scale;\n\n    this.ctx.drawImage(lcvs,cdx,cdy,cdw,cdh);\n\n    lcvs = lctx = null;\n    this._next();\n};\n\n// 获取宽高，兼容img，canvas\nMCanvas.prototype._getSize = function(img){\n    let iw,\n        ih;\n    if(img.tagName === 'IMG'){\n        iw = img.naturalWidth;\n        ih = img.naturalHeight;\n    }else if(img.tagName === 'CANVAS'){\n        iw = img.width;\n        ih = img.height;\n    }else{\n        iw = img.offsetWidth;\n        ih = img.offsetHeight;\n    }\n    return{iw,ih};\n};\n// 参数加工函数；\nMCanvas.prototype._handleOps = function(ops,img){\n    let cw = this.canvas.width,\n        ch = this.canvas.height;\n    let {iw,ih} = this._getSize(img);\n\n    // 图片宽高比；\n    let ratio = iw / ih;\n\n    // 根据参数计算后的绘制宽度；\n    let width =  this._get(cw,iw,ops.width,'pos');\n\n    // 裁剪的最大宽高；\n    let maxLsw,maxLsh;\n\n    // 裁剪参数；\n    let { x:cropx,y:cropy,width:cropw,height:croph } = ops.crop;\n    let crop = {\n        x: this._get(cw,iw,cropx,'crop'),\n        y: this._get(ch,ih,cropy,'crop'),\n        width:this._get(cw,iw,cropw,'crop'),\n        height:this._get(ch,ih,croph,'crop'),\n    };\n    // 最大值判定；\n    if(crop.x > iw)crop.x = iw;\n    if(crop.y > ih)crop.y = ih;\n    maxLsw = iw - crop.x;\n    maxLsh = ih - crop.y;\n    if(crop.width > maxLsw)crop.width = maxLsw;\n    if(crop.height > maxLsh)crop.height = maxLsh;\n\n    // 位置参数；\n    let { x: px, y: py, rotate: pr, scale: ps } = ops.pos;\n    let pos = {\n        x:this._get(cw,width,px,'pos'),\n        y:this._get(ch,width/ratio,py,'pos'),\n        scale : ps,\n        rotate : parseFloat(pr) * Math.PI / 180,\n    };\n    return {width,crop,pos};\n};\n\n// --------------------------------------------------------\n// 绘制文字部分；\n// --------------------------------------------------------\nMCanvas.prototype.text = function(context = '', ops){\n    // 默认字体；\n    let fontFamily = `helvetica neue,hiragino sans gb,Microsoft YaHei,arial,tahoma,sans-serif`;\n    // 默认的字体大小;\n    let size = this.canvas.width / 20;\n\n    this.queue.push(()=>{\n        let option = {\n            width : 300,\n            align : 'left',\n            smallStyle:{\n                font : `${size * 0.8}px ${fontFamily}`,\n                color:'#000',\n                lineheight:size * 0.9,\n            },\n            normalStyle:{\n                font : `${size }px ${fontFamily}`,\n                color:'#000',\n                lineheight:size*1.1,\n            },\n            largeStyle:{\n                font : `${size * 1.3}px ${fontFamily}`,\n                color:'#000',\n                lineheight:size * 1.4,\n            },\n            pos:{\n                x:0,\n                y:0,\n            },\n        };\n        option = _.extend(option,ops);\n\n        // 解析字符串模板后，调用字体绘制函数；\n        this._text(this._parse(context),option);\n        this._next();\n    });\n    return this;\n};\n// 字符串模板解析函数\n// 解析 <s></s> <b></b>\nMCanvas.prototype._parse = function(context){\n    let arr = context.split(/<s>|<b>/);\n    let result = [];\n    for(let i=0;i<arr.length;i++){\n        let value = arr[i];\n        if(/<\\/s>|<\\/b>/.test(value)){\n            let splitTag = /<\\/s>/.test(value) ? '</s>' : '</b>',\n                type     = /<\\/s>/.test(value) ? 'small' : 'large';\n            let tmp = arr[i].split(splitTag);\n            result.push({\n                type:type,\n                text:tmp[0],\n            });\n            tmp[1] && result.push({\n                type:'normal',\n                text:tmp[1],\n            });\n            continue;\n        }\n        arr[i] && result.push({\n            text:arr[i],\n            type:'normal',\n        });\n    }\n    return result;\n};\nMCanvas.prototype._text = function(textArr,option){\n    // 处理宽度参数；\n    option.width = this._get(this.canvas.width,0,option.width,'pos');\n\n    let style,line = 1,length = 0,\n        lineheight = getLineHeight(textArr,option),\n        x = this._get(this.canvas.width,option.width,option.pos.x,'pos'),\n        y = (this._get(this.canvas.height,0,option.pos.y,'pos')) + lineheight;\n\n    // data:字体数据；\n    // lineWidth:行宽；\n    this.textData[line] = {\n        data:[],\n        lineWidth:0,\n    };\n\n    // 生成字体数据；\n    textArr.forEach(v =>{\n        style = option[`${v.type}Style`];\n        this.ctx.font = style.font;\n        let width = this.ctx.measureText(v.text).width;\n\n        // 处理 <br> 换行，先替换成 '|',便于单字绘图时进行判断；\n        let context = v.text.replace(/<br>/g,'|');\n\n        // 先进行多字超出判断，超出宽度后再进行单字超出判断；\n        if((length + width) > option.width || context.indexOf('|') !== -1){\n            for (let i=0,fontLength = context.length; i < fontLength; i++) {\n                let font = context[i];\n                width = this.ctx.measureText(font).width;\n\n                // 当字体的计算宽度 > 设置的宽度 || 内容中包含换行时,进入换行逻辑；\n                if((length + width) > option.width || font == '|'){\n                    length = 0;\n                    x = this._get(this.canvas.width,option.width,option.pos.x,'pos');\n                    y += lineheight;\n                    line += 1;\n                    this.textData[line] = {\n                        data:[],\n                        lineWidth:0,\n                    };\n                    if(font == '|')continue;\n                }\n                this.textData[line]['data'].push({\n                    context:font,x,y,style,width,\n                });\n                length += width;\n                x += width;\n                this.textData[line]['lineWidth'] = length;\n            }\n        }else{\n            this.textData[line]['data'].push({\n                context,x,y,style,width,\n            });\n            length += width;\n            x += width;\n            this.textData[line]['lineWidth'] = length;\n        }\n    });\n\n    // 通过字体数据进行文字的绘制；\n    _.forin(this.textData,(k,v)=>{\n        // \b增加 align 的功能；\n        let add = 0;\n        if(v.lineWidth < option.width){\n            if(option.align == 'center'){\n                add = (option.width - v.lineWidth)/2;\n            }else if (option.align == 'right') {\n                add = option.width - v.lineWidth;\n            }\n        }\n        v.data.forEach(text=>{\n            text.x += add;\n            this._fillText(text);\n        });\n    });\n\n    // 获取行高；\n    function getLineHeight(textArr,option) {\n        let lh = 0,vlh;\n        textArr.forEach( v =>{\n            vlh = option[`${v.type}Style`].lineheight;\n            if(vlh > lh)lh = vlh;\n        });\n        return lh;\n    }\n};\nMCanvas.prototype._fillText = function(text){\n    let {context,x,y,style} = text;\n    this.ctx.font = style.font;\n    this.ctx.textAlign = style.align;\n    this.ctx.textBaseline = 'bottom';\n    this.ctx.fillStyle = style.color;\n    this.ctx.fillText(context,x,y);\n};\n\n// --------------------------------------------------------\n// 业务功能函数部分\n// --------------------------------------------------------\n\n// 参数加工函数；\n// 兼容 5 种 value 值：\n// x:250, x:'250px', x:'100%', x:'left:250',x:'center',\n// width:100,width:'100px',width:'100%'\nMCanvas.prototype._get = function(par,child,str,type){\n    let result = str;\n    if(typeof str === 'string'){\n        if(str.indexOf(':') !== -1 && type == 'pos'){\n            let arr = str.split(':');\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px',''));\n                    break;\n                case 'right':\n                case 'bottom':\n                    result = par - (+(arr[1].replace('px',''))) - child;\n                    break;\n                default:\n            }\n        }else if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''));\n        } else if (str.indexOf('%') !== -1) {\n            if(type == 'crop'){\n                result = child * (+str.replace('%', '')) / 100;\n            }else{\n                result = par * (+str.replace('%', '')) / 100;\n            }\n        }else if(str == 'center'){\n            result = (par-child)/2;\n        }else{\n            result = +str;\n        }\n    }\n    return result;\n};\n\n// 绘制函数；\nMCanvas.prototype.draw = function(fn = ()=>{}){\n    let b64;\n    this.end = () => {\n        setTimeout(()=>{\n            b64 = this.canvas.toDataURL('image/png');\n            fn(b64);\n        },0);\n    };\n    this._next();\n    return this;\n};\nMCanvas.prototype._next = function(){\n    if(this.queue.length > 0){\n        this.queue.shift()();\n    }else{\n        this.end();\n    }\n};\n","let base64 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABEBJREFUeNrsm01IVFEUx9+MpVMzgVrhLoqshdWMTq1GXbQpo1Vf0GChs6gk+sCFzUYwZMQaUTEQwYIQQ4Q+pEUfth5caCaYtCjLaJVkmajTSMh0DnMHJJ/v49x3573ROfAHec579/zmzpyPe+/Y4vG4tJHMLm0wywBngNeZbZK7WFZWtm4AI5GIOrCBtgPkAx0GFYJ2gbaDtrL/R0E/Qd9Ak6BR0BBoJqUzzGl5oHOgUyA3yKbw2mxQLmgv6CjoEgjz5DhoAPQYNGtV4AJQDejiihmkGL5BHqYgqB90DzRtlaCFb9pV/LqArnDC/m9bQAH2bBxjs9nAe0AvQfUgp8BY4GRj4Fj7zQI+DnoNOpjCoHsA9AJUkWrgC6AHoG0mZBqc7fvMh5QAV4HCoCwT02sW86FKNPAxUMhCdUWI+SQEeB+o0+SZlZvpTuabocCYDroER2Ke73SX1pSlFRgroCILl8xFzEdDgLGCqk2DPqGW+coNfMOiH2W5j/ZNXuB8kD+NusHzzGcy8BmQQ++ogUDANTg4WNDc3JzncDhsWu/D14bD4Ty8t7q62kUAdjCfuYB1W2VlpcvpdNrLy8sdLS0tmqDxNa2trfk+n8+B9/r9fhdxlk9TgbF5P0QZcXh4eCn5d0lJSY4adBLW4/FkJ6+NjIzEiMBupeClBFyq0ryvaY2Njb/HxsY0QcvBjo6OLoVCoTmOfrqUAuylRo5YLBavq6ubVYNeCzYYDM7iMziCl4cCXMgTLtWgBcJKbMlIfvrltlrYqiUupu3mzRMIhpAIm7yGb4LdbrcJgkX7KiUWD1etWqoFLW5ba6YFwir6rgTsMmhwWWiBsIq+p3TnAT/GMtdEDPWXArxg1OhyAUpPnibYAgV4xijYtra2VdFYa54m2hwFeMooWLfbvSpAacnTHPaFAjwpChYDlNbihGifKcDvRMHqrcgINk4BxsKDlCqamppy1WDVoBsaGnKJsDhGhAL8A/SeMmJxcXGOnjwrB+31enOIwOjzNDUPP6WM2NvbuxCNRuNQ1sW0FhVJaLwH7+3r65snAg8otlIKtXRyiectZdXDJMMe+gjoV/KCnlpaYjf2p9GaVv9KWGpp2QFaTAPYRearxAuMAaA9DYDbJQ2nBLRW7rg9OWFh2Anmo2QUMHYfeJxh3oKw2CjUKHVI1PYQa+vroGULwaIv15RqZ95++I2UOGthFatnPkmigNF6QLdMnull5kOP7kUI4oCPpMT2pBnfaUw/l5kPUqqA0fAET0WKo/cH0EnQK/IyE6cDU8yBO6ysE1ky3gWdAH3keZARK2iYDvBoIK4Dd0uJA6NG2R/QQymxddKhNfUomZFnLb+DbjP4s1JiFw834/Q28nHW4j0DPVGrjc0EXtlwdDPtZDOP+1R40kbp+PAntsoyxHpxISb6vDQ6/pzJErbhfgJgy/xuKQOcAU5r+yfAAGDyyaocNx08AAAAAElFTkSuQmCC`;\n\nexport default base64;\n","let sheet;\nexport default {\n    setPos(el, transform) {\n        let str = JSON.stringify(transform);\n        let value = `translate3d(${transform.x}px,${transform.y}px,0px) scale(${transform.scale}) rotate(${transform.rotate}deg)`;\n        el = this.getEl(el);\n        this.setStyle(el,{\n            transform : value,\n            webkitTransform : value,\n        });\n        el.setAttribute('data-mtouch-status', str);\n    },\n    getPos(el) {\n        if(!el)return;\n        let defaulTrans;\n        let style = window.getComputedStyle(el,null);\n        let cssTrans = style.transform || style.webkitTransform;\n\n        if(window.getComputedStyle && cssTrans !== 'none'){\n            defaulTrans = this.matrixTo(cssTrans);\n        }else{\n            defaulTrans = {\n                x: 0,\n                y: 0,\n                scale: 1,\n                rotate: 0,\n            };\n        }\n        return JSON.parse(el.getAttribute('data-mtouch-status')) || defaulTrans;\n    },\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if(typeof obj2[k] == 'object' && !(obj2[k] instanceof Node)){\n                    if(typeof obj1[k] !== 'object' || obj1[k] === null){\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k],obj2[k]);\n                }else{\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    getOffset(el){\n        el = this.getEl(el);\n        let offset = {};\n        offset.width = el.clientWidth || el.offsetWidth;\n        offset.height = el.clientHeight || el.offsetHeight;\n        return offset;\n    },\n    matrixTo(matrix){\n        // 解析 matrix 字符串，分割成数组；\n        let arr = (matrix.replace('matrix(','').replace(')','')).split(',');\n        // 根据不等式计算出 rotate 和 scale；\n        let cos = arr[0],\n            sin = arr[1],\n            tan = sin/cos,\n            rotate = Math.atan(tan)*180/Math.PI,\n            scale = cos/(Math.cos(Math.PI/180*rotate)),\n            trans;\n        // 传入翻译后的各项参数；\n        trans = {\n            x:parseInt(arr[4]),\n            y:parseInt(arr[5]),\n            scale,\n            rotate,\n        };\n        return trans;\n    },\n    domify(DOMString) {\n        let htmlDoc = document.implementation.createHTMLDocument();\n        htmlDoc.body.innerHTML = DOMString;\n        return htmlDoc.body.children;\n    },\n    getEl(el){\n        if(!el){\n            console.error('el error,there must be a el!');\n            return;\n        }\n        let _el;\n        if(typeof el == 'string'){\n            _el = document.querySelector(el);\n        }else if(el instanceof Node){\n            _el = el;\n        }else{\n            console.error('el error,there must be a el!');\n            return;\n        }\n        return _el;\n    },\n    setStyle(el,ops){\n        this.forin(ops,(k,v)=>{\n            el.style[k] = v;\n        });\n    },\n    addClass(el,cls){\n        let _cls;\n        el = this.getEl(el);\n        _cls = this.trim(el.className) || '';\n        if(_cls.indexOf(cls) == -1){\n            if(_cls.length == 0){\n                el.className = cls;\n            }else{\n                el.className = _cls + ` ${cls}`;\n            }\n        }\n        return this;\n    },\n    trim(str){\n        if(typeof str == 'string'){\n            return str.replace(/(^\\s*)|(\\s*$)/g, '');\n        }\n    },\n    removeClass(el,cls){\n        let _cls;\n        el = this.getEl(el);\n        _cls = el.className || '';\n        if(_cls.indexOf(cls) !== -1){\n            el.className = _cls.replace(new RegExp(cls, 'g'),'');\n        }\n    },\n    hasClass(el,cls){\n        el = this.getEl(el);\n        return el.className.indexOf(cls) !== -1;\n    },\n    forin(obj,cbk){\n        for(let k in obj){\n            if(obj.hasOwnProperty(k)){\n                cbk(k,obj[k]);\n            }\n        }\n    },\n    xRatio(pos,ratio){\n        pos.x *= ratio;\n        pos.y *= ratio;\n        return pos;\n    },\n    data(el,key,value){\n        el = this.getEl(el);\n        if(!value){\n            return el.getAttribute(`data-${key}`);\n        }else{\n            el.setAttribute(`data-${key}`,value);\n            return this;\n        }\n    },\n    include(str1,str2){\n        if(str1.indexOf){\n            return str1.indexOf(str2) !== -1;\n        }else{\n            return false;\n        }\n    },\n    delegate(par,evName,child,fn = ()=>{}){\n        let _par = this.getEl(par);\n        _par.addEventListener(evName,ev=>{\n            let target = ev.target;\n            while(target !== _par ){\n                if(child.indexOf('.') == 0){\n                    if(this.include(target.className,child.substring(1))){\n                        ev.delegateTarget = target;\n                        fn.bind(target)(ev);\n                        break;\n                    }\n                }else if(child.indexOf('#') == 0){\n                    if(target.id == child.substring(1)){\n                        ev.delegateTarget = target;\n                        fn.bind(target)(ev);\n                        break;\n                    }\n                }else{\n                    if(target.tagName.toLowerCase() == child){\n                        ev.delegateTarget = target;\n                        fn.bind(target)(ev);\n                        break;\n                    }\n                }\n                target = target.parentNode;\n            }\n        });\n    },\n    addCssRule(selector, rules){\n        if(!sheet){\n            sheet = createStyleSheet();\n        }\n        sheet.insertRule(`${selector}{${rules}}`,sheet.rules.length);\n    },\n    remove(el){\n        let _par = el.parentNode || el.parentElement;\n        _par.removeChild(el);\n    },\n    loadImage(image, success, error) {\n        let img = new Image();\n        let loaded = false;\n        if(image.indexOf('http') == 0){\n            img.crossOrigin = '*';\n        }\n        img.onload = () => {\n            if(!loaded){\n                loaded = true;\n                success(img);\n            }\n        };\n        img.onerror = () => {\n            error('img load error');\n        };\n        img.src = image;\n    },\n    getImage(image,success,error){\n        if(typeof image == 'string'){\n            this.loadImage(image, img => {\n                success(img);\n            },err=>{\n                console.log(err);\n                error(err);\n            });\n        }else if(typeof image == 'object' && image instanceof Node){\n            success(image);\n        }else{\n            console.log('add image error');\n            error('type of image is error!');\n            return;\n        }\n    },\n    isArr(arr) {\n        return Object.prototype.toString.call(arr) === '[object Array]';\n    },\n};\n\nfunction createStyleSheet() {\n    let style = document.createElement('style');\n    style.type = 'text/css';\n    document.head.appendChild(style);\n    return style.sheet;\n}\n","// 素材层级管理系统；\nimport _ from './utils';\nexport default class ZIndex {\n    constructor(config) {\n        this.config = {\n            'min': 50,\n            'max': 100,\n        };\n        this.config = _.extend(this.config, config);\n        this.topIndex = this.config.min;\n        this.zIndexArr = [];\n    }\n    init(){\n        this.zIndexArr = [];\n        this.topIndex = this.config.min;\n    }\n    setIndex(id) {\n        this.zIndexArr.push(id);\n        if (this.topIndex > this.config.max) {\n            this.resetIndex();\n        } else {\n            let el = document.querySelector(`#${id}`);\n            el.style.zIndex = this.topIndex;\n            this.topIndex++;\n        }\n    }\n    removeIndex(id) {\n        this.zIndexArr.forEach((value, index, arr) => {\n            if (value == id) {\n                arr.splice(index, 1);\n            }\n        });\n    }\n    resetIndex() {\n        this.zIndexArr.forEach((id, index) => {\n            let el = document.querySelector(`#${id}`);\n            el.style.zIndex = this.config.min+index;\n        });\n        this.topIndex = this.zIndexArr.length + this.config.min;\n    }\n    toTop(id) {\n        if (id !== this.zIndexArr[this.zIndexArr.length - 1]) {\n            this.removeIndex(id);\n            this.setIndex(id);\n        }\n    }\n}\n","import MT from 'mtouch';\nimport MC from 'mcanvas';\nimport removeBtn from './removeBtn';\nimport ZIndex from './zIndex';\nimport _ from './utils';\n\nconst EVENT = ['touchstart','touchmove','touchend','drag','dragstart','dragend','pinch','pinchstart','pinchend','rotate','rotatestart','rotatend','singlePinchstart','singlePinch','singlePinchend','singleRotate','singleRotatestart','singleRotatend'];\nconst noop = function () {};\n\nwindow.requestAnimFrame = (function() {\n    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || function(callback) {\n        window.setTimeout(callback, 1000 / 60);\n    };\n})();\n\nexport default function Touchkit(ops) {\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof Touchkit))\n        return new Touchkit(ops);\n\n    this._ops = {\n        el: null,\n        use:{\n            drag:false,\n            pinch:false,\n            rotate:false,\n            singlePinch:false,\n            singleRotate:false,\n        },\n        limit:false,\n        // event\n        event: {},\n    };\n\n    EVENT.map(eventName => this._ops.event[eventName] = noop);\n\n    if(typeof ops == 'object'){\n        this._ops = _.extend(this._ops, ops);\n    }else if(typeof ops == 'string'){\n        this._ops.el = ops;\n    }\n\n    // 手势容器；\n    this.el = _.getEl(this._ops.el);\n\n    _.addClass(this.el,'mt-touch-box');\n    // 容器宽高，优先使用clientWidth，避免边框等因素的影响；\n    this.elStatus = {\n        width:this.el.clientWidth || this.el.offsetWidth,\n        height:this.el.clientHeight || this.el.offsetHeight,\n    };\n\n    // 初始化mtouch；\n    this.mt = MT(this.el);\n    this._insertCss()._init()._bind();\n\n}\n\nTouchkit.prototype._init = function(childs = {}){\n    // 操作元素\n    this.operator = null;\n    this.operatorStatus = null;\n\n    this._cropBox = false;\n\n    this.transform = null;\n    this.freezed = false;\n    // 子元素仓库，index用于标记子元素；\n    this._childs = childs;\n    this._childIndex = 0;\n    this._activeChild = null;\n    // 管理子元素之间的zindex层级关系；\n    this._zIndexBox = new ZIndex();\n    return this;\n};\n\nTouchkit.prototype.background = function(ops){\n    let _ops = {\n        // 背景图片，type: url/HTMLImageElement/HTMLCanvasElement\n        image:'' ,\n        // 绘制方式: crop / contain\n            // crop : 裁剪模式，背景图自适应铺满画布，多余部分裁剪；\n            // contain : 包含模式, 类似于 background-size:contain; 可通过left/top值进行位置的控制；\n        type:'contain',\n        // 背景图片距离画布左上角的距离，\n        left:0,\n        top:0,\n        // 在type=crop时使用，背景图只需启动拖动操作；\n        use:{},\n        static:false,\n        success(){},\n        error(){},\n    };\n    _ops = _.extend(_ops,ops);\n    _.getImage(_ops.image, img => {\n        // 背景图真实宽高及宽高比；\n        let {iw,ih} = this._getSize(img);\n        let iratio = iw / ih;\n        // 容器宽高及宽高比；\n        let pw = this.elStatus.width,\n            ph = this.elStatus.height,\n            pratio = pw / ph;\n\n        let left,top,width,height;\n        let minX = 0 , minY = 0;\n        let ratio;\n\n        let template = _.domify(`<div class=\"mt-background\" data-mt-index=\"background\" data-mt-bg-type=${_ops.type}><div class=\"mt-prevent\"></div></div>`)[0];\n\n        // 初始化背景图属性；\n        _.addClass(img,'mt-image');\n        template.appendChild(img);\n\n        if(_ops.type == 'contain'){\n            if(iratio > pratio){\n                left = _ops.left || 0;\n                top = _ops.top || (ph - pw/iratio) / 2;\n                width = pw;\n                height = pw / iratio;\n                ratio = iw / width;\n            }else{\n                left = _ops.left || (pw - ph*iratio) / 2;\n                top = _ops.top || 0;\n                width = ph*iratio;\n                height = ph;\n                ratio = ih / height;\n            }\n            if(!ops.static){\n                _ops.use = {\n                    drag:true,\n                    pinch:true,\n                    rotate:true,\n                };\n            }\n        }else if(_ops.type == 'crop'){\n            left = 0;\n            top = 0;\n            if(iratio > pratio){\n                width = ph*iratio;\n                height = ph;\n                minX = (width - pw)/width;\n                ratio = ih / height;\n            }else{\n                width = pw;\n                height = pw/iratio;\n                minY = (height - ph)/height;\n                ratio = iw / width;\n            }\n            _ops.limit = {\n                x:minX,\n                y:minY,\n                maxScale:1,\n                minScale:1,\n            };\n            if(!ops.static){\n                _ops.use = {\n                    drag : true,\n                };\n            }\n        }\n        _.setStyle(template,{\n            width:`${width}px`,\n            height:`${height}px`,\n            transform:`translate(${left}px,${top}px)`,\n            webkitTransform:`translate(${left}px,${top}px)`,\n        });\n\n        _ops.pos = {width,height,left,top};\n\n        this.el.appendChild(template);\n\n        // 记录背景图参数；\n        _ops.ratio = ratio;\n\n        this._childs.background = {\n            el:template,\n            ops: _ops,\n            type:'background',\n        };\n        _ops.success(this);\n    },(err)=>{\n        _ops.error(err);\n    });\n    return this;\n};\n\nTouchkit.prototype.add = function(ops){\n    let _ops = {\n        image:'',\n        width:'',\n        use:{\n            drag:false,\n            pinch:false,\n            rotate:false,\n            singlePinch:false,\n            singleRotate:false,\n        },\n        limit:false,\n        pos:{\n            x:0,\n            y:0,\n            scale:1,\n            rotate:0,\n        },\n        close:false,\n        success(){},\n        error(){},\n    };\n\n    if(!_.isArr(ops))ops = [ops];\n\n    ops.forEach(v=>{\n        _.getImage(v.image,img=>{\n            if(v.use == 'all'){\n                v.use ={\n                    drag:true,\n                    pinch:true,\n                    rotate:true,\n                    singlePinch:true,\n                    singleRotate:true,\n                };\n            }\n            this._add(img,_.extend(_ops,v));\n        },err=>{\n            _ops.error(err);\n        });\n    });\n    return this;\n};\n\nTouchkit.prototype._add = function(img,ops){\n    let {iw,ih} = this._getSize(img);\n    let iratio = iw / ih;\n    let _templateEl = img;\n    let _ele = _.domify(`<div class=\"mt-child\" id=\"mt-child-${this._childIndex}\" data-mt-index=\"${this._childIndex}\"><div class=\"mt-prevent\"></div></div>`)[0];\n    let originWidth = this._get('hor',ops.width),\n        originHeight = originWidth / iratio;\n    // space 为因为缩放造成的偏移误差；\n    let spaceX = (ops.pos.scale - 1) * originWidth/2,\n        spaceY = (ops.pos.scale - 1) * originHeight/2;\n    _.setStyle(_ele,{\n        width:`${originWidth}px`,\n        height:`${originHeight}px`,\n    });\n\n    _.addClass(_templateEl,'mt-image');\n    _ele.appendChild(_templateEl);\n    // 是否添加关闭按钮；\n    if(ops.close || this._ops.close){\n        _ele.appendChild(_.domify(`<div class=\"mt-close-btn\"></div>`)[0]);\n    }\n    this.el.appendChild(_ele);\n\n    ops.pos ={\n        x:this._get('hor',ops.pos.x) + spaceX,\n        y:this._get('ver',ops.pos.y) + spaceY,\n        scale:ops.pos.scale,\n        rotate:ops.pos.rotate,\n    };\n\n    // 记录数据；\n    this._childs[this._childIndex] = {\n        el:_ele,\n        ops: ops,\n        type:'element',\n    };\n    // 根据id进行zIndex的设置；\n    this._zIndexBox.setIndex(`mt-child-${this._childIndex}`);\n\n    // 没有开启单指操作时，不添加单指按钮；\n    let addButton = ((ops.use.singlePinch || this._ops.use.singlePinch) || (ops.use.singleRotate || this._ops.use.singleRotate)) ? true : false;\n    // 切换operator到新添加的元素上；\n    this.switch(_ele,addButton);\n\n    this._setTransform('all', _ele , ops.pos);\n\n    _.setStyle(_ele,{\n        visibility:'visible',\n    });\n\n    this._childIndex++;\n    ops.success(this);\n};\nTouchkit.prototype.cropBox = function(){\n    let cropBox = _.domify(`<div class=\"mt-crop-box\" data-mt-index=\"cropBox\"><div class=\"mt-close-btn\"></div></div>`)[0];\n    this.el.appendChild(cropBox);\n    this.switch(cropBox);\n    this._cropBox = true;\n    this._childs['cropBox'] = {\n        el:cropBox,\n        type:'cropBox',\n        ops: {\n            width:cropBox.offsetWidth,\n            height:cropBox.offsetHeight,\n            use:{\n                drag:true,\n                pinch:false,\n                rotate:false,\n                singlePinch:true,\n                singleRotate:false,\n            },\n            limit:{\n                x:0,\n                y:0,\n                maxScale:1,\n                minScale:0.2,\n            },\n        },\n    };\n};\n// 使用 mcanvas 合成图片后导出 base64;\nTouchkit.prototype.exportImage = function(cbk,cropOps){\n    let cwidth = this.elStatus.width,\n        cheight = this.elStatus.height;\n    let ratio = 1;\n    let addChilds =[];\n\n    if(this._childs.background){\n        let bg = this._childs.background;\n        ratio = bg.ops.ratio;\n        let image = bg.el.querySelector('.mt-image');\n        let bgPos = _.xRatio(_.getPos(bg.el),ratio);\n        addChilds.push({\n            image:image,\n            options:{\n                width:image.width * ratio,\n                pos:bgPos,\n            },\n        });\n    }\n\n    let mc = new MC(cwidth*ratio,cheight*ratio,'#ffffff');\n\n    this._zIndexBox.zIndexArr.forEach(v=>{\n        let child = document.querySelector('#'+v);\n        let image = child.querySelector('.mt-image');\n        let childPos = _.xRatio(_.getPos(child),ratio);\n        let width = image.clientWidth || image.offsetWidth;\n        addChilds.push({\n            image:image,\n            options:{\n                width: width * ratio,\n                pos:childPos,\n            },\n        });\n    });\n    mc.add(addChilds).draw(b64=>{\n        if(this._cropBox){\n            let cropBoxOps = this._childs.cropBox;\n            let cropBox = cropBoxOps.el;\n            let cropBoxPos = _.getPos(cropBox);\n            let corpBoxMc = new MC(cropBoxOps.ops.width * ratio,cropBoxOps.ops.height * ratio);\n            corpBoxMc.add(mc.canvas,{\n                width:mc.canvas.width,\n                pos:{\n                    x: -cropBoxPos.x * ratio,\n                    y: -cropBoxPos.y * ratio,\n                    scale:1,\n                    rotate:0,\n                },\n            }).draw(b64=>{\n                cbk(b64);\n            });\n        }else if(cropOps){\n            let _default = {\n                x:0,\n                y:0,\n                width:'100%',\n                height:'100%',\n            };\n            cropOps = _.extend(_default,cropOps);\n            cropOps.width = this._get('hor',cropOps.width,(mc.canvas.width-cropOps.x));\n            cropOps.height = this._get('ver',cropOps.height,(mc.canvas.height-cropOps.y));\n            let cropMc = new MC(cropOps.width,cropOps.height);\n            cropMc.add(mc.canvas,{\n                width:mc.canvas.width,\n                pos:{\n                    x: -cropOps.x ,\n                    y: -cropOps.y,\n                    scale:1,\n                    rotate:0,\n                },\n            }).draw(b64=>{\n                cbk(b64);\n            });\n        }else{\n            cbk(b64);\n        }\n    });\n};\n\nTouchkit.prototype._bind = function(){\n    // 绑定所有事件；\n    EVENT.forEach(evName=>{\n        if(!this[evName]){\n            this[evName] = () =>{\n                this._ops.event[evName]();\n            };\n        }\n        this.mt.on(evName,this[evName].bind(this));\n    });\n\n    // 切换子元素；\n    let bgStart,childStart;\n    _.delegate(this.el,'touchstart','.mt-background',()=>{\n        bgStart = new Date().getTime();\n    });\n\n    _.delegate(this.el,'touchend','.mt-background',ev=>{\n        if(new Date().getTime() - bgStart > 300 || ev.touches.length)return;\n        this.switch(ev.delegateTarget,false);\n    });\n\n    _.delegate(this.el,'touchend','.mt-crop-box',ev=>{\n        if(ev.touches.length > 0)return;\n        this.switch(ev.delegateTarget);\n    });\n\n    // 点击子元素外的区域失去焦点；\n    this.el.addEventListener('click',ev=>{\n        if(!this._isAdd(ev.target)){\n            this.switch(null);\n        }\n    });\n\n    _.delegate(this.el,'touchstart','.mt-child',()=>{\n        childStart = new Date().getTime();\n    });\n\n    // 切换子元素；\n    _.delegate(this.el,'touchend','.mt-child',ev=>{\n        if(new Date().getTime() - childStart > 300 || ev.touches.length > 0)return;\n        let el = ev.delegateTarget,\n            _ops = this._getOperatorOps(el),\n            _addButton = ((_ops.use.singlePinch || this._ops.use.singlePinch) || (_ops.use.singleRotate || this._ops.use.singleRotate)) ? true : false;\n        this.switch(el,_addButton);\n        this._zIndexBox.toTop(el.id);\n    });\n\n    // 关闭按钮事件；\n    _.delegate(this.el,'click','.mt-close-btn',ev=>{\n        let _el = ev.delegateTarget;\n        let _child = _el.parentNode || _el.parentElement;\n        let index = _.data(_child,'mt-index');\n        if(index == 'cropBox'){\n            this.switch(null);\n            this._cropBox = false;\n        }else{\n            this._zIndexBox.removeIndex(_child.id);\n        }\n        _.remove(_child);\n        this._childs[index] = null;\n    });\n\n    return this;\n};\n\nTouchkit.prototype.touchstart = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            this.transform = _.getPos(this.operator);\n        }\n        this._ops.event.touchstart(ev);\n    }\n};\n\nTouchkit.prototype.drag = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            let ops = this._getOperatorOps();\n            if(ops.use.drag || this._ops.use.drag){\n                this.transform.x += ev.delta.deltaX;\n                this.transform.y += ev.delta.deltaY;\n                this._setTransform('drag');\n            }\n        }\n        this._ops.event.drag(ev);\n    }\n};\n\nTouchkit.prototype.pinch = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            let ops = this._getOperatorOps();\n            if(ops.use.pinch || this._ops.use.pinch){\n                this.transform.scale *= ev.delta.scale;\n                this._setTransform('pinch');\n            }\n        }\n        this._ops.event.pinch(ev);\n    }\n};\nTouchkit.prototype.rotate = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            let ops = this._getOperatorOps();\n            if(ops.use.rotate || this._ops.use.rotate){\n                this.transform.rotate += ev.delta.rotate;\n                this._setTransform('rotate');\n            }\n        }\n        this._ops.event.rotate(ev);\n    }\n};\nTouchkit.prototype.singlePinch = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            let ops = this._getOperatorOps();\n            if(_.data(this.operator,'mt-index') == 'cropBox'){\n                if(ops.use.singlePinch || this._ops.use.singlePinch){\n                    let cropBoxPos = _.getPos(this.operator);\n                    if((ops.width + ev.delta.deltaX + cropBoxPos.x) < this.elStatus.width){\n                        ops.width += ev.delta.deltaX;\n                    }\n                    if((ops.height + ev.delta.deltaY + cropBoxPos.y) < this.elStatus.height){\n                        ops.height += ev.delta.deltaY;\n                    }\n                    _.setStyle(this.operator,{\n                        width:`${ops.width}px`,\n                        height:`${ops.height}px`,\n                    });\n                }\n            }else{\n                if(ops.use.singlePinch || this._ops.use.singlePinch){\n                    this.transform.scale *= ev.delta.scale;\n                    this._setTransform('pinch');\n                }\n            }\n        }\n        this._ops.event.singlePinch(ev);\n    }\n};\nTouchkit.prototype.singleRotate = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            let ops = this._getOperatorOps();\n            if(ops.use.singleRotate || this._ops.use.singleRotate){\n                this.transform.rotate += ev.delta.rotate;\n                this._setTransform('rotate');\n            }\n        }\n        this._ops.event.singleRotate(ev);\n    }\n};\nTouchkit.prototype._setTransform = function(type, el = this.operator, transform = this.transform) {\n    let trans = JSON.parse(JSON.stringify(transform));\n    let ops = this._getOperatorOps();\n    let defaulLimit = (this._ops.limit && typeof this._ops.limit == 'object') ? _.extend({\n        x:0.5,\n        y:0.5,\n        maxScale:3,\n        minScale:0.4,\n    },this._ops.limit) : {\n        x:0.5,\n        y:0.5,\n        maxScale:3,\n        minScale:0.4,\n    };\n    let _limit = (ops.limit && ops.limit !== true) ? _.extend(defaulLimit,ops.limit) : defaulLimit;\n\n    if(ops.limit || this._ops.limit){\n        trans = this._limitOperator(trans,_limit);\n    }\n    if((ops.use.singlePinch || this._ops.use.singlePinch) && (type == 'all' || type == 'pinch')){\n        let singlePinchBtn = el.querySelector(`.mtouch-singleButton`);\n        _.setStyle(singlePinchBtn,{\n            transform:`scale(${1/trans.scale})`,\n            webkitTransform:`scale(${1/trans.scale})`,\n        });\n    }\n    if((ops.close || this._ops.close) && (type == 'all' || type == 'pinch')){\n        let closeBtn = el.querySelector(`.mt-close-btn`);\n        _.setStyle(closeBtn,{\n            transform:`scale(${1/trans.scale})`,\n            webkitTransform:`scale(${1/trans.scale})`,\n        });\n    }\n    window.requestAnimFrame(()=>{\n        _.setPos(el, trans);\n    });\n};\nTouchkit.prototype._limitOperator = function(transform,limit) {\n    // 实时获取操作元素的状态；\n    let {minScale, maxScale} = limit;\n    let operatorStatus,spaceX,spaceY,boundaryX,boundaryY,minX,minY,maxX,maxY;\n    if (minScale && transform.scale < minScale){\n        transform.scale = minScale;\n    }\n    if (maxScale && transform.scale > maxScale){\n        transform.scale = maxScale;\n    }\n    operatorStatus = _.getOffset(this.operator);\n    // 因缩放产生的间隔；\n    spaceX = operatorStatus.width * (transform.scale - 1) / 2;\n    spaceY = operatorStatus.height * (transform.scale - 1) / 2;\n    // 参数设置的边界值；\n    boundaryX = operatorStatus.width * transform.scale  * (limit.x);\n    boundaryY = operatorStatus.height * transform.scale * (limit.y);\n    // 4个边界状态；\n    minX = spaceX - boundaryX;\n    minY = spaceX - boundaryY;\n    maxX = this.elStatus.width - operatorStatus.width * transform.scale + spaceX + boundaryX;\n    maxY = this.elStatus.height - operatorStatus.height * transform.scale + spaceY + boundaryY;\n\n    if(limit.x || limit.x == 0){\n        if(transform.x >= maxX)transform.x = maxX;\n        if(transform.x < minX)transform.x = minX;\n    }\n    if(limit.y || limit.y == 0){\n        if(transform.y > maxY)transform.y = maxY;\n        if(transform.y < minY)transform.y = minY;\n    }\n    return transform;\n};\nTouchkit.prototype.switch = function(el,addButton){\n    if(!this.mt || this.freezed)return;\n    if(el)el = _.getEl(el);\n    _.forin(this._childs,(k,v)=>{\n        if(v){\n            _.removeClass(v.el,'mt-active');\n        }\n    });\n    // 转换操作元素后，也需要重置 mtouch 中的单指缩放基本点 singleBasePoint;\n    this.mt.switch(el,addButton);\n    // 切换operator;\n    this.operator = el;\n    if(el){\n        _.addClass(el,'mt-active');\n        this._activeChild = el;\n    }\n    return this;\n};\n\nTouchkit.prototype._getOperatorOps = function(target){\n    let _tar = target || this.operator;\n    let index = _.data(_tar,'mt-index');\n    if(this._childs[index]){\n        return this._childs[index].ops;\n    }\n};\n\n// 冻结手势容器，暂停所有操作，且失去焦点；\n// 解冻后恢复最后状态；\nTouchkit.prototype.freeze = function(boolean){\n    if(boolean){\n        _.forin(this._childs,(k,v)=>{\n            if(v){\n                _.removeClass(v.el,'mt-active');\n            }\n        });\n    }else{\n        _.addClass(this._activeChild,'mt-active');\n    }\n    this.freezed = boolean ? true:false;\n    return this;\n};\n\nTouchkit.prototype.clear = function(index = null){\n    if (index !== null) {\n        try {\n            _.remove(this.getChild(index).el);\n            this._childs[index] = null;    \n        } catch (error) {\n            console.error('Can not find this el or has been deleted!');\n        }\n    } else {\n        _.forin(this._childs,(k,v)=>{\n            if(v && v.type == 'element'){\n                _.remove(v.el);\n                this._childs[k] = null;\n            }\n        });\n        this._init(this._childs);\n    }\n    return this;\n};\n\n// 重置所有状态到初始化阶段；\nTouchkit.prototype.reset = function(){\n    _.forin(this._childs,(k,v)=>{\n        if(v){\n            _.remove(v.el);\n        }\n    });\n    this._init();\n    return this;\n};\n\n// 销毁，但保持原有样式，失去焦点与事件绑定；\nTouchkit.prototype.destory = function(){\n    _.forin(this._childs,(k,v)=>{\n        if(v){\n            _.removeClass(v.el,'mt-active');\n        }\n    });\n    this.mt && this.mt.destroy();\n    this.mt = null;\n};\n// 参数加工函数；\n// 兼容 5 种 value 值：\n// x:250, x:'250px', x:'100%', x:'left:250',x:'center',\n// width:100,width:'100px',width:'100%'\nTouchkit.prototype._get = function(drection,str,par , child){\n    let result = str;\n    let k,_par,_child;\n    if(document.body && document.body.clientWidth){\n        k = drection == 'hor' ? 'clientWidth':'clientHeight';\n    }else{\n        k = drection == 'hor' ? 'offsetWidth' : 'offsetHeight';\n    }\n    _par = par || this.el[k];\n    _child = child || (this.operator ? this.operator[k] : 0);\n    if(typeof str === 'string'){\n        if(_.include(str,':')){\n            let arr = str.split(':');\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px',''));\n                    break;\n                case 'right':\n                case 'bottom':\n                    result = _par - (+(arr[1].replace('px',''))) - _child;\n                    break;\n                default:\n            }\n        }else if (_.include(str,'px')) {\n            result = (+str.replace('px', ''));\n        } else if (_.include(str,'%')) {\n            result = _par * (+str.replace('%', '')) / 100;\n        }else if(str == 'center'){\n            result = (_par-_child)/2;\n        }else{\n            result = +str;\n        }\n    }\n    return result;\n};\n\nTouchkit.prototype.getChild = function(index){\n    return this._childs[index] || null;\n};\n\nTouchkit.prototype._isAdd = function(el){\n    let target = el;\n    while(target !== this.el || target.tagName.toLowerCase() == 'body'){\n        if(_.include(target.className,'mt-child') || _.include(target.className,'mt-background') || _.include(target.className,'mt-crop-box')){\n            return true;\n        }\n        target = target.parentNode;\n    }\n    return false;\n};\n\nTouchkit.prototype._getSize = function(img){\n    let iw,ih;\n    if(img.tagName === 'IMG'){\n        iw = img.naturalWidth;\n        ih = img.naturalHeight;\n    }else if(img.tagName === 'CANVAS'){\n        iw = img.width;\n        ih = img.height;\n    }else{\n        iw = img.offsetWidth;\n        ih = img.offsetHeight;\n    }\n    return{iw,ih};\n};\n\nTouchkit.prototype._insertCss = function(){\n    _.addCssRule('.mt-touch-box','-webkit-user-select: none;');\n    _.addCssRule('.mtouch-singleButton','display: none;');\n    _.addCssRule('.mt-child.mt-active','z-index: 99;outline:2px solid hsla(0,0%,100%,.5);');\n    _.addCssRule('.mt-active .mtouch-singleButton,.mt-active .mt-close-btn','display: inline-block;');\n    _.addCssRule('.mt-child','position:absolute;text-align:left;visibility:hidden;');\n    _.addCssRule('.mt-image','width:100%;height:100%;position:absolute;left:0;top:0;text-align:left;');\n    _.addCssRule('.mt-close-btn',`z-index:999;position:absolute;width:30px;height:30px;top:-15px;right:-15px;background-size:100%;display:none;background-image:url(${removeBtn})`);\n    _.addCssRule('.mt-background','position:absolute;left:0;top:0;');\n    _.addCssRule('.mt-crop-box','position:absolute;left:5px;top:5px;width:90%;height:90%;border:2px dashed #996699;box-sizing:border-box;z-index:20;');\n    _.addCssRule('.mt-prevent','width:100%;height:100%;position:absolute;left:0;top:0;z-index:99;');\n    return this;\n};\n"],"names":["sheet","v1","error","Math","sqrt","x","y","v2","direction","getLength","len2","mr","len1","dot","r","acos","PI","el","offset","getOffset","left","getBoundingClientRect","width","top","round","obj1","obj2","k","hasOwnProperty","_typeof","Node","extend","p1","p2","ev","index","touches","pageX","pageY","document","querySelector","rect","body","scrollLeft","scrollTop","offsetWidth","offsetHeight","matrix","arr","replace","split","cos","sin","tan","rotate","atan","scale","trans","parseInt","evName","useName","end","indexOf","DOMString","htmlDoc","implementation","createHTMLDocument","innerHTML","children","_el","key","getEl","getAttribute","str1","str2","defaulTrans","style","window","getComputedStyle","cssTrans","transform","webkitTransform","matrixTo","JSON","parse","selector","rules","createStyleSheet","insertRule","length","createElement","type","head","appendChild","base64","HandlerBus","handlers","handler","push","forEach","value","splice","apply","_this2","EVENT","ORIGINEVENT","MTouch","use","operator","_","draging","pinching","rotating","singlePinching","singleRotating","fingers","startScale","startPoint","secondPoint","pinchStartLength","singlePinchStartLength","vector1","singleBasePoint","_css","_driveBus","_bind","prototype","_this","fn","bind","addEventListener","destroy","removeEventListener","_this3","_start","e","getPoint","getBasePoint","getVector","singlePinch","pinchV1","touchstart","fire","origin","eventType","_move","isSingleButton","data","target","curFingers","curPoint","singlePinchLength","pinchLength","rotateV1","rotateV2","pinchV2","curSecPoint","vector2","pinch","_eventFire","getAngle","singleRotate","drag","touchmove","preventDefault","_end","_eventEnd","touchend","ing","start","_addButton","button","domify","setAttribute","switch","addButton","on","include","_on","v","getUseName","add","off","del","addCssRule","singleBtn","image","loaded","img","Image","crossOrigin","onload","onerror","src","Object","toString","call","cbk","loadImage","log","err","obj","MCanvas","cwidth","cheight","background","ops","canvas","ctx","queue","textData","bgConfig","_init","height","getContext","fillStyle","fillRect","bg","color","getImage","_background","_getSize","iw","ih","iRatio","cRatio","sx","sy","swidth","sheight","dx","dy","dwidth","dheight","drawImage","_next","watermark","pos","margin","position","options","def","isArr","_add","_handleOps","ratio","cdx","cdy","cdw","cdh","crop","lsx","lsy","lsw","lsh","ldx","ldy","ldw","ldh","lcvs","lctx","_ratio","lctxScale","spaceX","spaceY","translate","tagName","naturalWidth","naturalHeight","cw","ch","_get","maxLsw","maxLsh","cropx","cropy","cropw","croph","px","py","pr","ps","parseFloat","text","context","fontFamily","size","option","_text","_parse","result","i","test","splitTag","tmp","textArr","line","lineheight","getLineHeight","font","_this4","measureText","fontLength","forin","lineWidth","align","_fillText","lh","vlh","textAlign","textBaseline","fillText","par","child","str","draw","b64","_this5","toDataURL","shift","stringify","setStyle","clientWidth","clientHeight","cls","_cls","trim","className","RegExp","_par","substring","delegateTarget","id","toLowerCase","parentNode","parentElement","removeChild","success","ZIndex","config","topIndex","min","zIndexArr","max","resetIndex","zIndex","removeIndex","setIndex","noop","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","callback","setTimeout","Touchkit","_ops","map","event","eventName","addClass","elStatus","mt","MT","_insertCss","childs","operatorStatus","_cropBox","freezed","_childs","_childIndex","_activeChild","_zIndexBox","iratio","pw","ph","pratio","minX","minY","template","static","limit","_templateEl","_ele","originWidth","originHeight","close","_setTransform","cropBox","exportImage","cropOps","addChilds","bgPos","xRatio","getPos","mc","MC","childPos","cropBoxOps","cropBoxPos","corpBoxMc","_default","cropMc","bgStart","childStart","delegate","Date","getTime","_isAdd","_getOperatorOps","toTop","_child","remove","delta","deltaX","deltaY","defaulLimit","_limit","_limitOperator","singlePinchBtn","closeBtn","setPos","minScale","maxScale","boundaryX","boundaryY","maxX","maxY","removeClass","_tar","freeze","boolean","clear","getChild","reset","destory","drection","removeBtn"],"mappings":"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"}